<div class="container-fluid">

	<div class="row">
		<div class="col-12">
			<p class="lead text-primary">
				<strong>FY{{ thisfy }} : <span class="text-dark">{{ data.rows|length|number }} Pledge </span><span class="text-muted"> (either created, started or status changed)</span></strong>
				<small class="text-secondary font-italic">data captured : {{ data.timestamp|dtAU }}, cached for {{ '{:,}'.format(data.cached_timeout) }} seconds</small>
			</p>
		</div>
	</div>

	<div class="row">
		<div class="col-lg-6">
			<div class="chart" id="flow1" >{{ loading('ellipsis') }}</div>
		</div>
		<div class="col-lg-6">
			<div class="chart" id="flow2" >{{ loading('ellipsis') }}</div>
		</div>
	</div>

	<div class="row"><!-- ROW -->
		<div class="col-lg-7 col-md-12">

			<div class="table-responsive-lg">
				<table class="table table-sm table-hover table-bordered text-right">
					<thead>
						<tr class="bg-secondary text-light">
							<th scope="col" style="width: 30%">SPONSORSHIP CATEGORY</th>
							<th scope="col" style="width: 10%">CREATED</th><th scope="col" style="width: 10%" class="text-warning">NEW</th>
							<th scope="col" style="width: 10%">ACTIVE</th>
							<th scope="col" style="width: 10%">ONHOLD</th>
							<th scope="col" style="width: 10%">CANCELLED</th>
							<th scope="col" style="width: 10%">CLOSED</th>
							<th scope="col" style="width: 10%">FINISHED</th>
						</tr>
					</thead><!-- End of Table Head -->
					<tbody>
						{% for type, typeList in data.rows|groupby('SPONSORSHIP1') %}
						{% set calc1 = typeList|selectattr('CREATED_FY','equalto',thisfy)|list|length %}
						{% set calc2 = typeList|selectattr('CREATED_FY','<=',thisfy)|selectattr('START_FY','equalto',thisfy)|list|length %}
						{% set calc3 = typeList|selectattr('CREATED_FY','<=',thisfy)|selectattr('PLEDGESTATUS','equalto','Active')|list|length %}
						{% set calc4 = typeList|selectattr('CREATED_FY','<=',thisfy)|selectattr('PLEDGESTATUS','equalto','On Hold')|selectattr('ONHOLD_FY','equalto',thisfy)|list|length %}
						{% set calc5 = typeList|selectattr('CREATED_FY','<=',thisfy)|selectattr('PLEDGESTATUS','equalto','Written Down')|selectattr('WRITTENDOWN_FY','equalto',thisfy)|list|length %}
						{% set calc6 = typeList|selectattr('CREATED_FY','<=',thisfy)|selectattr('PLEDGESTATUS','equalto','Closed')|selectattr('CLOSED_FY','equalto',thisfy)|list|length %}
						{% set calc7 = typeList|selectattr('CREATED_FY','<=',thisfy)|selectattr('PLEDGESTATUS','equalto','Closed')|selectattr('FINISHED_FY','equalto',thisfy)|list|length %}
						<tr>
							<th scope="row" style="color:{{ typeList[0].SPONSORSHIP1_COLOR }}">{{ type }}</th>
							<td>{{ calc1|number or '' }}</td>
							<td>{{ calc2|number or '' }}</td>
							<td>{{ calc3|number or '' }}</td>
							<td>{{ calc4|number or '' }}</td>
							<td>{{ calc5|number or '' }}</td>
							<td>{{ calc6|number or '' }}</td>
							<td>{{ calc7|number or '' }}</td>
						</tr>
						{% endfor %}
					</tbody><!-- End of Table Body -->
					<tfoot>
						<tr class="bg-light text-dark font-weight-bold">
							<th>Total</th>
							<td>{{ data.rows|selectattr('CREATED_FY','equalto',thisfy)|list|length|number }}</td>
							<td>{{ data.rows|selectattr('CREATED_FY','<=',thisfy)|selectattr('START_FY','equalto',thisfy)|list|length|number }}</td>
							<td>{{ data.rows|selectattr('CREATED_FY','<=',thisfy)|selectattr('PLEDGESTATUS','equalto','Active')|list|length|number }}</td>
							<td>{{ data.rows|selectattr('CREATED_FY','<=',thisfy)|selectattr('PLEDGESTATUS','equalto','On Hold')|selectattr('ONHOLD_FY','equalto',thisfy)|list|length|number }}</td>
							<td>{{ data.rows|selectattr('CREATED_FY','<=',thisfy)|selectattr('PLEDGESTATUS','equalto','Written Down')|selectattr('WRITTENDOWN_FY','equalto',thisfy)|list|length|number }}</td>
							<td>{{ data.rows|selectattr('CREATED_FY','<=',thisfy)|selectattr('PLEDGESTATUS','equalto','Closed')|selectattr('CLOSED_FY','equalto',thisfy)|list|length|number }}</td>
							<td>{{ data.rows|selectattr('CREATED_FY','<=',thisfy)|selectattr('PLEDGESTATUS','equalto','Closed')|selectattr('FINISHED_FY','equalto',thisfy)|list|length|number }}</td>
						</tr>
					</tfoot>
				</table><!-- End of Table -->
			</div><!-- End of Table Responsive -->

			<div class="table-responsive-lg">
				<table class="table table-sm table-hover table-bordered text-right">
					<thead>
						<tr class="bg-secondary text-light">
							<th scope="col" style="width: 30%">SPONSORSHIP SUBCATEGORY</th>
							<th scope="col" style="width: 10%">CREATED</th><th scope="col" style="width: 10%" class="text-warning">NEW</th>
							<th scope="col" style="width: 10%">ACTIVE</th>
							<th scope="col" style="width: 10%">ONHOLD</th>
							<th scope="col" style="width: 10%">CANCELLED</th>
							<th scope="col" style="width: 10%">CLOSED</th>
							<th scope="col" style="width: 10%">FINISHED</th>
						</tr>
					</thead><!-- End of Table Head -->
					<tbody>
						{% for type, typeList in data.rows|groupby('SPONSORSHIP2') %}
						{% set calc1 = typeList|selectattr('CREATED_FY','equalto',thisfy)|list|length %}
						{% set calc2 = typeList|selectattr('CREATED_FY','<=',thisfy)|selectattr('START_FY','equalto',thisfy)|list|length %}
						{% set calc3 = typeList|selectattr('CREATED_FY','<=',thisfy)|selectattr('PLEDGESTATUS','equalto','Active')|list|length %}
						{% set calc4 = typeList|selectattr('CREATED_FY','<=',thisfy)|selectattr('PLEDGESTATUS','equalto','On Hold')|selectattr('ONHOLD_FY','equalto',thisfy)|list|length %}
						{% set calc5 = typeList|selectattr('CREATED_FY','<=',thisfy)|selectattr('PLEDGESTATUS','equalto','Written Down')|selectattr('WRITTENDOWN_FY','equalto',thisfy)|list|length %}
						{% set calc6 = typeList|selectattr('CREATED_FY','<=',thisfy)|selectattr('PLEDGESTATUS','equalto','Closed')|selectattr('CLOSED_FY','equalto',thisfy)|list|length %}
						{% set calc7 = typeList|selectattr('CREATED_FY','<=',thisfy)|selectattr('PLEDGESTATUS','equalto','Closed')|selectattr('FINISHED_FY','equalto',thisfy)|list|length %}
						<tr>
							<th scope="row" style="color:{{ typeList[0].SPONSORSHIP1_COLOR }}"><small class="font-weight-bold">{{ type }}</small></th>
							<td>{{ calc1|number or '' }}</td>
							<td>{{ calc2|number or '' }}</td>
							<td>{{ calc3|number or '' }}</td>
							<td>{{ calc4|number or '' }}</td>
							<td>{{ calc5|number or '' }}</td>
							<td>{{ calc6|number or '' }}</td>
							<td>{{ calc7|number or '' }}</td>
						</tr>
						{% endfor %}
					</tbody><!-- End of Table Body -->
					<tfoot>
						<tr class="bg-light text-dark font-weight-bold">
							<th>Total</th>
							<td>{{ data.rows|selectattr('CREATED_FY','equalto',thisfy)|list|length|number }}</td>
							<td>{{ data.rows|selectattr('CREATED_FY','<=',thisfy)|selectattr('START_FY','equalto',thisfy)|list|length|number }}</td>
							<td>{{ data.rows|selectattr('CREATED_FY','<=',thisfy)|selectattr('PLEDGESTATUS','equalto','Active')|list|length|number }}</td>
							<td>{{ data.rows|selectattr('CREATED_FY','<=',thisfy)|selectattr('PLEDGESTATUS','equalto','On Hold')|selectattr('ONHOLD_FY','equalto',thisfy)|list|length|number }}</td>
							<td>{{ data.rows|selectattr('CREATED_FY','<=',thisfy)|selectattr('PLEDGESTATUS','equalto','Written Down')|selectattr('WRITTENDOWN_FY','equalto',thisfy)|list|length|number }}</td>
							<td>{{ data.rows|selectattr('CREATED_FY','<=',thisfy)|selectattr('PLEDGESTATUS','equalto','Closed')|selectattr('CLOSED_FY','equalto',thisfy)|list|length|number }}</td>
							<td>{{ data.rows|selectattr('CREATED_FY','<=',thisfy)|selectattr('PLEDGESTATUS','equalto','Closed')|selectattr('FINISHED_FY','equalto',thisfy)|list|length|number }}</td>
						</tr>
						</tr>
					</tfoot>
				</table><!-- End of Table -->
			</div><!-- End of Table Responsive -->

		</div><!-- End of COLUMN -->

		<div class="col-xl-5 col-md-12">
			<div class="row"><!-- ROW -->
				<div class="col-12">
					<div class="chart " id="chart1" >{{ loading('ellipsis') }}</div>
				</div>
			</div><!-- END OF ROW -->
			<div class="row"><!-- ROW -->
				<div class="col-12">
					<div class="chart " id="chart2" >{{ loading('ellipsis') }}</div>
				</div>
			</div><!-- END OF ROW -->
		</div><!-- End of COLUMN -->

	</div><!-- END OF ROW -->

</div>


<script>
let data = JSON.parse({{ data.to_json()|tojson }});
let thisFY = {{ thisfy }};
</script>
